import requests
import pandas as pd

def fetch_goes_xray_flux():
    """
    Retrieve GOES X-ray flux data (1-minute cadence).
    """
    url = "https://services.swpc.noaa.gov/json/goes/primary/xrays-1-minute.json"
    res = requests.get(url)
    data = res.json()

    df = pd.DataFrame(data)
    df["time_tag"] = pd.to_datetime(df["time_tag"], utc=True)

    # Select two channels: short (0.5–4 Å) and long (1–8 Å)
    df = df[["time_tag", "flux", "energy"]]

    # Only keep the long channel (1–8 Å), which determines flare class
    df = df[df["energy"] == "xl"]

    df = df.rename(columns={"time_tag": "timestamp", "flux": "solar_flux"})
    return df
